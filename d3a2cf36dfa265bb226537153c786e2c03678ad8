{
  "comments": [
    {
      "key": {
        "uuid": "d174f2ce_e9ad17b7",
        "filename": "repo/config/Wikibase.default.php",
        "patchSetId": 2
      },
      "lineNbr": 351,
      "author": {
        "id": 6768
      },
      "writtenOn": "2019-05-31T10:36:43Z",
      "side": 1,
      "message": "So this is going to be used in the following way:\n\n- MIGRATION_OLD \u003d\u003e read old, write old\n- MIGRATION_WRITE_BOTH \u003d\u003e read old, write both\n- MIGRATION_WRITE_NEW \u003d\u003e read new, write both (maybe this needs to be called MIGRATION_READ_NEW instead?)\n- MIGRATION_NEW \u003d\u003e read new, write new\n\nright?",
      "revId": "d3a2cf36dfa265bb226537153c786e2c03678ad8",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85527c52_430d948f",
        "filename": "repo/config/Wikibase.default.php",
        "patchSetId": 2
      },
      "lineNbr": 351,
      "author": {
        "id": 4699
      },
      "writtenOn": "2019-06-03T11:20:45Z",
      "side": 1,
      "message": "You can see MediaWiki’s interpretation of these values in includes/Defines.php; in short:\n\n* MIGRATION_OLD ⇒ read/write old\n* MIGRATION_WRITE_BOTH ⇒ write both, read new falling back to old\n* MIGRATION_WRITE_NEW ⇒ write new, read new falling back to old\n* MIGRATION_NEW ⇒ read/write new\n\nHowever, in this patch the middle stages are interpreted a bit differently:\n\n* MIGRATION_WRITE_BOTH ⇒  write both, read old falling back to new\n* MIGRATION_WRITE_NEW ⇒ write both, read new falling back to old\n\nI think I’d convinced myself that this was okay, but I’m not sure why anymore.",
      "parentUuid": "d174f2ce_e9ad17b7",
      "revId": "d3a2cf36dfa265bb226537153c786e2c03678ad8",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ce70345b_a09c577f",
        "filename": "repo/includes/WikibaseRepo.php",
        "patchSetId": 2
      },
      "lineNbr": 1832,
      "author": {
        "id": 6768
      },
      "writtenOn": "2019-05-31T10:36:43Z",
      "side": 1,
      "message": "MultiPropertyTermStore will need to know a little more here for lookup (resolving terms).\n\nin MIGRATION_WRITE_BOTH it above, MultiPropertyTermStore will have to continue reading only from old\nin MIGRATION_WRITE_NEW here, it will have to read from new (and keep writing to both).\n\nrelated comment https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Wikibase/+/513158/2/repo/config/Wikibase.default.php#351\n\n---\n\nI was actually expecting write and read to have separate configuration to make things more explicit .. like\n`tmpPropertyTermsMigrationReadFrom` and `tmpPropertyTermsMigrationWriteTo`. does that sounds better to you too?\n\n---\n\nEitherway, we probably need to tell MultiPropertyTermStore somehow where to read from and write to by passing it the value of `$propertyTermsMigrationStage` here (or two values if we change to separate configuration variables).\n\nThe alternative solution is to have a separate implementation for each migration stage (which sounds a bit of an overkill for something temporary to me)",
      "revId": "d3a2cf36dfa265bb226537153c786e2c03678ad8",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "459ad29f_704e78b6",
        "filename": "repo/includes/WikibaseRepo.php",
        "patchSetId": 2
      },
      "lineNbr": 1832,
      "author": {
        "id": 6768
      },
      "writtenOn": "2019-05-31T11:01:27Z",
      "side": 1,
      "message": "I just noticed, after reading a different patch commit message, that \u0027read from\u0027 is determined here by the order of term stores inside MlutiPropertyTermStore.\n\nThen this likes more okay to me than before. It is still not that explicit (maybe due to MultiPropertyTermStore is a bit more generic compared to, say MigrationPropertyTermStore that accepts only two stores, old and new). But since it is just temporary, it should be fine.",
      "parentUuid": "ce70345b_a09c577f",
      "revId": "d3a2cf36dfa265bb226537153c786e2c03678ad8",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6f2e3b81_9b3748d9",
        "filename": "repo/includes/WikibaseRepo.php",
        "patchSetId": 2
      },
      "lineNbr": 1832,
      "author": {
        "id": 4699
      },
      "writtenOn": "2019-06-03T11:20:45Z",
      "side": 1,
      "message": "Yes, the order of the stores determines the read order (though it will fall back to later stores if empty fingerprints are returned).",
      "parentUuid": "459ad29f_704e78b6",
      "revId": "d3a2cf36dfa265bb226537153c786e2c03678ad8",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    }
  ]
}