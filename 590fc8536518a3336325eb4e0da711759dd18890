{
  "comments": [
    {
      "key": {
        "uuid": "6ec1af18_89bcf5b2",
        "filename": "client/includes/Hooks/DataUpdateHookHandlers.php",
        "patchSetId": 4
      },
      "lineNbr": 218,
      "author": {
        "id": 128
      },
      "writtenOn": "2015-08-20T15:43:38Z",
      "side": 1,
      "message": "We have to be really careful where $langCode comes from. We have to do this consistently everywhere - that is, job deduplication, parser cache key, parser function, and lua library have to agree exactly on which language is used. Ideally, they would share the same code for figuring that out.\nIn *theory*, $parserOptions-\u003egetTargetLanguage() should be it. In practice, this is however not the case. When we target the user language for output, $pops-\u003egetTargetLanguage() still returns the content language. I consider that a bug in core - cure just needs to  support the concept of multilingual page output.",
      "revId": "590fc8536518a3336325eb4e0da711759dd18890",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ec1af18_ec1d8767",
        "filename": "client/includes/Hooks/DataUpdateHookHandlers.php",
        "patchSetId": 4
      },
      "lineNbr": 218,
      "author": {
        "id": 33
      },
      "writtenOn": "2015-08-20T16:28:34Z",
      "side": 1,
      "message": "I would ideally like to have this code in some place in core, per the bug.\n\nthere is Parser::getTargetLanguage which calls ParserOptions-\u003egetTargetLanguage() which is just a getter for the setter, and by default not set.\n\nwe could call the setter if getUserLang is called (which is weirdly named, because it splits cache)\n\nthere is more issue with having knowledge of the page language, which is the default. ParserOptions is not aware of the title.\n\nsuggestions?",
      "parentUuid": "6ec1af18_89bcf5b2",
      "revId": "590fc8536518a3336325eb4e0da711759dd18890",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ec1af18_7eeff9ad",
        "filename": "client/includes/Hooks/DataUpdateHookHandlers.php",
        "patchSetId": 4
      },
      "lineNbr": 218,
      "author": {
        "id": 33
      },
      "writtenOn": "2015-08-21T09:18:14Z",
      "side": 1,
      "message": "have submitted https://gerrit.wikimedia.org/r/#/c/232826/ and https://gerrit.wikimedia.org/r/#/c/232757/ to help improve the situation.\n\nin the meanwhile, maybe i can put it in a helper class in Wikibase Lib and make sure these different places share the same code for determining language used for parsing.",
      "parentUuid": "6ec1af18_ec1d8767",
      "revId": "590fc8536518a3336325eb4e0da711759dd18890",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ec1af18_1e63553c",
        "filename": "client/includes/Hooks/DataUpdateHookHandlers.php",
        "patchSetId": 4
      },
      "lineNbr": 218,
      "author": {
        "id": 128
      },
      "writtenOn": "2015-08-21T09:44:51Z",
      "side": 1,
      "message": "That sounds like an ok solution for now.",
      "parentUuid": "6ec1af18_7eeff9ad",
      "revId": "590fc8536518a3336325eb4e0da711759dd18890",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}