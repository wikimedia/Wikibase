This page describes how wikibase entities are represented and stored inside MediaWiki.


== Storage ==

Entities (or more precisely, entity description documents) are stored as MediaWiki page content, serialized according to JSON binding of the Wikibase data model. The JSON structure encodes an EntityDocument, EntityContent and EntityHandler provide the necessary glue to allow MediaWIki to handle EntityDocument as page content.

In order to store entities on wiki pages, a mapping between entity IDs and page titles is required. In the simplest case, the entity ID is used as the page title directly, with the appropriate namespace prefix. For this purpose, and entity type is associated with a namespace. Since entity IDs encode the entity type, this in principle allows multiple entity types to share the same namespace. However, support for multiple entity types sharing the same namespace directly is currently not implemented,at least not for top-level entities (see below for details).

In some cases, it may be desirable to store multiple entities on the same page - conceptually, this may be interpreted as a top-level entity containing several sub-entities (or "inner" entities) which are similar to the idea of sections in MediaWiki. Just as with sections, the ID of such an inner entity has to contain the ID of the parent (top level) entity, so it can be used as an address for finding the inner entity in the database.

This implies that the relationship between entity IDs and page titles is unique only in one direction: each entity ID is associated with a single page, but multiple entity IDs can map to the same page (or sections of the same page, depending on interpretation). The same is true for the relationship between entity types and mediaWiki namespaces.


== Enumeration ==

As a consequence of the above principles, efficient enumeration of all entity IDs can be achieved by enumerating all titles in a namespace, but this is only possible for top-level entities. In order to enumerate sub-entities contained within top-level entities, it may be required to load each top-level entity.


== Redirects ==

Some entity types may support redirects. A MediaWiki redirect from one page title to another shall be interpreted as the two entity IDs referring to the same entity (indeed, the same entity as well as the same entity description). The titles of redirect pages correspond to secondary IDs of the entity, while the title of the page that actually contains the entity description corresponds to the canonical entity ID. The entity description will typically only contain the canonical ID.


== Versioning ==

Wikibase supports the concepts of versioning through EntityRevisions. These roughly correspond to MediaWiki page revisions, with one notable difference: the revision ID is considered to be unique only relative to a given entity ID, not globally, as in MediaWiki.

In particular, updating a single sub-entity will create a new revision of the page that contains that sub-entity. This implies that it also creates a new revision for every other entity contained on that page, including the top level entity. These "incidental" entity revisions correspond to the concept of "null revisions" in MediaWiki: between the new revision and its parent, only the (sub-)entities touched by the intentional edit change; all other entities on the page remain unchanged between the old and the new revision.


== Permissions ==

The permission to perform actions on entities are mapped to MediaWiki page permissions by an EntityPermissionChecker. This means that the same permissions apply to all entities on a page, and page protection (restrictions) aso apply to all entities. However, the same operation (like changing a label) can be mapped to different actions for different entity types (e.g. item-term and property-term), which in effect allows permissions and restrictions to be managed per entity type on a page (but not per individual entity).
