{
  "comments": [
    {
      "key": {
        "uuid": "4e1dcb5b_29d3f562",
        "filename": "client/includes/hooks/LanguageLinkBadgeDisplay.php",
        "patchSetId": 10
      },
      "lineNbr": 82,
      "author": {
        "id": 128
      },
      "writtenOn": "2014-05-22T17:05:32Z",
      "side": 1,
      "message": "This causes a database query for every language link on every page view. That\u0027s quite bad, and also pointless: the  query is used to find out which item to load for the page title. The same item, over and over. Even though the item datat itself is (hopefully) cached, just querying the item id from the database over and over is too expensive.\n\nFind a way to cache the knowledge of which entity id is bound to the page. There could be local caching introduced in the ClientSiteLinkLookup class (and the ClientSiteLinkLookup should then be cached in the WikibaseClient instance). You could also try to find a hook that would allow you to process all the links at once, instead setting up a whole fresh network of service objects for every link.",
      "revId": "846f40caadf57db65d6d6666c30d6fd6f6799a89",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e1dcb5b_09995980",
        "filename": "client/includes/hooks/LanguageLinkBadgeDisplay.php",
        "patchSetId": 10
      },
      "lineNbr": 82,
      "author": {
        "id": 549
      },
      "writtenOn": "2014-05-22T17:56:40Z",
      "side": 1,
      "message": "You mentioned the idea of using another hook. The problem is that Wikibase inserts the links by actually abiding wikitext, eg. [[en:foobar]], to the page which then gets parsed again by MediaWiki itself again. This behavior is quite bad in my opinion but that\u0027s the way it is implemented atm. So we either need to change the core parser to accept badges in this syntax or we change the way sitelinks are added to the pages. None of this problems can be fixed very easily however.",
      "parentUuid": "4e1dcb5b_29d3f562",
      "revId": "846f40caadf57db65d6d6666c30d6fd6f6799a89",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e1dcb5b_943579f6",
        "filename": "client/includes/hooks/LanguageLinkBadgeDisplay.php",
        "patchSetId": 10
      },
      "lineNbr": 82,
      "author": {
        "id": 128
      },
      "writtenOn": "2014-05-23T09:47:43Z",
      "side": 1,
      "message": "Then implement better caching for now. A new db query for every link is a No Go.",
      "parentUuid": "4e1dcb5b_09995980",
      "revId": "846f40caadf57db65d6d6666c30d6fd6f6799a89",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}